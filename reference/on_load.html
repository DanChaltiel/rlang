<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Run expressions on load — on_load • rlang</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Run expressions on load — on_load" />
<meta property="og:description" content="

on_load() registers expressions to be run on the user's machine
each time the package is loaded in memory. This is by contrast to
normal R package code which is run once at build time on the
packager's machine (e.g. CRAN).
on_load() expressions require run_on_load() to be called
inside .onLoad().
on_package_load() registers expressions to be run each time
another package is loaded.


on_load() is for your own package and runs expressions when the
namespace is not sealed yet. This means you can modify existing
binding or create new ones. This is not the case with
on_package_load() which runs expressions after a foreign package
has finished loading, at which point its namespace is sealed." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rlang</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.11.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../reference/lifecycle.html">Life cycle</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Release notes</li>
    <li>
      <a href="https://www.tidyverse.org/blog/2020/02/glue-strings-and-tidy-eval/">Version 0.4.3</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/06/rlang-0-4-0/">Version 0.4.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/01/rlang-0-3-1/">Version 0.3.1</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2018/10/rlang-0-3-0/">Version 0.3.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2018/03/rlang-0.2.0/">Version 0.2.0</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-lib/rlang/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Run expressions on load</h1>
    <small class="dont-index">Source: <a href='https://github.com/r-lib/rlang/blob/master/R/aaa.R'><code>R/aaa.R</code></a></small>
    <div class="hidden name"><code>on_load.Rd</code></div>
    </div>

    <div class="ref-description">
    
<ul>
<li><p><code>on_load()</code> registers expressions to be run on the user's machine
each time the package is loaded in memory. This is by contrast to
normal R package code which is run once at build time on the
packager's machine (e.g. CRAN).</p>
<p><code>on_load()</code> expressions require <code>run_on_load()</code> to be called
inside <code><a href='https://rdrr.io/r/base/ns-hooks.html'>.onLoad()</a></code>.</p></li>
<li><p><code>on_package_load()</code> registers expressions to be run each time
another package is loaded.</p></li>
</ul>

<p><code>on_load()</code> is for your own package and runs expressions when the
namespace is not <em>sealed</em> yet. This means you can modify existing
binding or create new ones. This is not the case with
<code>on_package_load()</code> which runs expressions after a foreign package
has finished loading, at which point its namespace is sealed.</p>
    </div>

    <pre class="usage"><span class='fu'>on_load</span><span class='op'>(</span><span class='va'>expr</span>, env <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sys.parent.html'>parent.frame</a></span><span class='op'>(</span><span class='op'>)</span>, ns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ns-topenv.html'>topenv</a></span><span class='op'>(</span><span class='va'>env</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>run_on_load</span><span class='op'>(</span>ns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ns-topenv.html'>topenv</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sys.parent.html'>parent.frame</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>on_package_load</span><span class='op'>(</span><span class='va'>pkg</span>, <span class='va'>expr</span>, env <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sys.parent.html'>parent.frame</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>expr</th>
      <td><p>An expression to run on load.</p></td>
    </tr>
    <tr>
      <th>env</th>
      <td><p>The environment in which to evaluate <code>expr</code>. Defaults to
the current environment, which is your package namespace if you
run <code>on_load()</code> at top level.</p></td>
    </tr>
    <tr>
      <th>ns</th>
      <td><p>The namespace in which to hook <code>expr</code>.</p></td>
    </tr>
    <tr>
      <th>pkg</th>
      <td><p>Package to hook expression into.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="when-should-i-run-expressions-on-load-"><a class="anchor" href="#when-should-i-run-expressions-on-load-"></a>When should I run expressions on load?</h2>

    

<p>There are two main use cases for running expressions on load:</p><ol>
<li><p>When a side effect, such as registering a method with
<code>s3_register()</code>, must occur in the user session rather than the
package builder session.</p></li>
<li><p>To avoid hard-coding objects from other packages in your
namespace. If you assign <code>foo::bar</code> or the result of
<code>foo::baz()</code> in your package, they become constants. Any
upstream changes in the <code>foo</code> package will not be reflected in
the objects you've assigned in your namespace. This often breaks
assumptions made by the authors of <code>foo</code> and causes all sorts of
issues.</p>
<p>Recreating the foreign objects each time your package is loaded
makes sure that any such changes will be taken into account. In
technical terms, running an expression on load introduces
<em>indirection</em>.</p></li>
</ol>

    <h2 class="hasAnchor" id="comparison-with-onload-"><a class="anchor" href="#comparison-with-onload-"></a>Comparison with <code><a href='https://rdrr.io/r/base/ns-hooks.html'>.onLoad()</a></code></h2>

    

<p><code>on_load()</code> has the advantage that hooked expressions can appear in
any file, in context. This is unlike <code><a href='https://rdrr.io/r/base/ns-hooks.html'>.onLoad()</a></code> which gathers
disparate expressions in a single block.</p>
<p><code>on_load()</code> is implemented via <code><a href='https://rdrr.io/r/base/ns-hooks.html'>.onLoad()</a></code> and requires
<code>run_on_load()</code> to be called from that hook.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/substitute.html'>quote</a></span><span class='op'>(</span><span class='op'>{</span>  <span class='co'># Not run</span>

<span class='co'># First add `run_on_load()` to your `.onLoad()` hook,</span>
<span class='co'># then use `on_load()` anywhere in your package</span>
<span class='va'>.onLoad</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>lib</span>, <span class='va'>pkg</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'>run_on_load</span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># Register a method on load</span>
<span class='fu'>on_load</span><span class='op'>(</span><span class='fu'>s3_register</span><span class='op'>(</span><span class='st'>"foo::bar"</span>, <span class='st'>"my_class"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># Assign an object on load</span>
<span class='va'>var</span> <span class='op'>&lt;-</span> <span class='cn'>NULL</span>
<span class='fu'>on_load</span><span class='op'>(</span>
  <span class='va'>var</span> <span class='op'>&lt;-</span> <span class='fu'>foo</span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='co'># To use `on_package_load()` at top level, wrap it in `on_load()`</span>
<span class='fu'>on_load</span><span class='op'>(</span><span class='fu'>on_package_load</span><span class='op'>(</span><span class='st'>"foo"</span>, <span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"foo is loaded"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># In functions it can be called directly</span>
<span class='va'>f</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='fu'>on_package_load</span><span class='op'>(</span><span class='st'>"foo"</span>, <span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"foo is loaded"</span><span class='op'>)</span><span class='op'>)</span>

<span class='op'>}</span><span class='op'>)</span>
</div><div class='output co'>#&gt; {
#&gt;     .onLoad &lt;- function(lib, pkg) {
#&gt;         run_on_load()
#&gt;     }
#&gt;     on_load(s3_register("foo::bar", "my_class"))
#&gt;     var &lt;- NULL
#&gt;     on_load(var &lt;- foo())
#&gt;     on_load(on_package_load("foo", message("foo is loaded")))
#&gt;     f &lt;- function() on_package_load("foo", message("foo is loaded"))
#&gt; }</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Lionel Henry, <a href='http://hadley.nz'>Hadley Wickham</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


